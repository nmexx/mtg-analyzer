<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="How the CommanderTables Monte Carlo simulator works ‚Äî assumptions, methodology and tips."
    />
    <title>How It Works ‚Äî Commandertables</title>
    <!-- Apply saved theme before paint to avoid flash.
         IMPORTANT: this <script> must come before any <link rel="stylesheet">.
         Inline scripts wait for preceding stylesheets to load, so putting the
         link first would cause a flash of light mode before data-theme is set. -->
    <script>
      document.documentElement.setAttribute(
        'data-theme',
        localStorage.getItem('mtg_mca_theme') ?? 'dark'
      );
    </script>
    <link rel="stylesheet" href="./src/index.css" />
    <style>
      /* ‚îÄ‚îÄ Tutorial-specific layout ‚îÄ‚îÄ */
      .tutorial-root {
        max-width: 860px;
        margin: 0 auto;
        padding: 20px;
        background-color: var(--clr-bg);
        color: var(--clr-text);
        font-family: 'Inter', 'Segoe UI', sans-serif;
      }

      /* Section panels */
      .tutorial-section {
        background: var(--clr-bg-panel);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-sm);
        padding: 32px 36px;
        margin-bottom: 24px;
      }

      .tutorial-section h2 {
        margin: 0 0 12px;
        font-size: 1.35rem;
        color: var(--clr-primary);
        border-bottom: 2px solid var(--clr-border);
        padding-bottom: 10px;
      }

      .tutorial-section h3 {
        margin: 24px 0 8px;
        font-size: 1rem;
        font-weight: 700;
        color: var(--clr-text);
      }

      .tutorial-section p {
        margin: 0 0 14px;
        line-height: 1.75;
        color: var(--clr-text);
        font-size: 0.95rem;
      }

      .tutorial-section ul,
      .tutorial-section ol {
        margin: 0 0 14px 0;
        padding-left: 24px;
        line-height: 1.8;
        font-size: 0.95rem;
        color: var(--clr-text);
      }

      /* Image placeholder */
      .tutorial-img {
        display: block;
        max-width: 100%;
        border-radius: var(--radius-md);
        margin: 16px 0;
        border: 1px solid var(--clr-border);
      }

      .tutorial-img-placeholder {
        width: 100%;
        min-height: 220px;
        border-radius: var(--radius-md);
        border: 2px dashed var(--clr-border);
        background: var(--clr-bg-muted);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--clr-faint);
        font-size: 0.85rem;
        margin: 16px 0;
      }

      /* Callout box */
      .callout {
        background: var(--clr-bg-accent);
        border-left: 4px solid var(--clr-primary);
        border-radius: 0 var(--radius-md) var(--radius-md) 0;
        padding: 12px 16px;
        margin: 16px 0;
        font-size: 0.9rem;
        line-height: 1.65;
        color: var(--clr-text);
      }
    </style>
  </head>

  <body>
    <div class="tutorial-root">
      <!-- ‚îÄ‚îÄ Header ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div class="app-header">
        <div class="app-header__titles">
          <h1>Commandertables</h1>
          <p>Monte Carlo mana-base analyzer for Magic: The Gathering</p>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ Toolbar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div class="app-toolbar">
        <div class="app-toolbar__left">
          <a
            class="toolbar-btn toolbar-btn--yt"
            href="https://www.youtube.com/@CommanderTables/videos"
            target="_blank"
            rel="noopener noreferrer"
          >
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path
                d="M23.5 6.2a3 3 0 0 0-2.1-2.1C19.5 3.5 12 3.5 12 3.5s-7.5 0-9.4.6A3 3 0 0 0 .5 6.2 31.5 31.5 0 0 0 0 12a31.5 31.5 0 0 0 .5 5.8 3 3 0 0 0 2.1 2.1c1.9.6 9.4.6 9.4.6s7.5 0 9.4-.6a3 3 0 0 0 2.1-2.1A31.5 31.5 0 0 0 24 12a31.5 31.5 0 0 0-.5-5.8zM9.75 15.5V8.5l6.25 3.5-6.25 3.5z"
              />
            </svg>
            Watch on YouTube
          </a>
          <a class="toolbar-btn toolbar-btn--active" href="./index.html">‚Üê Back to Analyzer</a>
        </div>
        <div class="app-toolbar__right">
          <button class="toolbar-btn" id="theme-toggle" title="Toggle dark / light mode">
            ‚òÄÔ∏è Light
          </button>
        </div>
      </div>

      <!-- ================================================================== -->
      <!--  CONTENT                                                           -->
      <!-- ================================================================== -->

      <!-- ‚îÄ‚îÄ Table of Contents ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div class="tutorial-section" style="padding: 20px 28px">
        <h2 style="margin-bottom: 10px">üìñ Contents</h2>
        <ol style="columns: 2; column-gap: 40px; margin: 0">
          <li>
            <a href="#mc-intro" style="color: var(--clr-primary)"
              >What Is a Monte Carlo Simulation?</a
            >
          </li>
          <li><a href="#assumptions" style="color: var(--clr-primary)">Core Assumptions</a></li>
          <li><a href="#turn-anatomy" style="color: var(--clr-primary)">Turn Anatomy</a></li>
          <li>
            <a href="#land-behaviour" style="color: var(--clr-primary)">Land Behaviour in Detail</a>
          </li>
          <li>
            <a href="#modelled" style="color: var(--clr-primary)">What Is &amp; Isn't Modelled</a>
          </li>
          <li><a href="#mulligans" style="color: var(--clr-primary)">Mulligan Logic</a></li>
          <li><a href="#keycards" style="color: var(--clr-primary)">Key-Card Playability</a></li>
          <li>
            <a href="#flood-screw" style="color: var(--clr-primary)">Flood &amp; Screw Tracking</a>
          </li>
          <li><a href="#tips" style="color: var(--clr-primary)">Tips &amp; Tricks</a></li>
        </ol>
      </div>

      <!-- ‚îÄ‚îÄ 1. What Is a Monte Carlo Simulation? ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div id="mc-intro" class="tutorial-section">
        <h2>üé≤ What Is a Monte Carlo Simulation?</h2>

        <p>
          A <strong>Monte Carlo simulation</strong> answers questions about probability by running a
          random experiment thousands of times and measuring how often each outcome occurs. Instead
          of working out exact math for every card interaction, the tool simply plays out your deck
          ‚Äî shuffle, draw, play lands, cast spells ‚Äî and counts the results across 10,000 (or more)
          independent games.
        </p>
        <p>
          For a Magic: The Gathering mana-base this means:
          <em
            >in what percentage of games can I cast my key card on turn N, given this exact 100-card
            list?</em
          >
          The more iterations you run, the closer the percentages converge to the true probability.
        </p>

        <!-- Monte Carlo loop diagram -->
        <svg
          viewBox="0 0 760 140"
          xmlns="http://www.w3.org/2000/svg"
          style="display: block; width: 100%; margin: 20px 0; font-family: sans-serif"
        >
          <defs>
            <marker id="arr" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
              <path d="M0,0 L0,6 L8,3 z" fill="var(--clr-primary,#7c5cfc)" />
            </marker>
          </defs>
          <!-- boxes -->
          <rect
            x="10"
            y="45"
            width="110"
            height="50"
            rx="8"
            fill="var(--clr-bg-accent,#2a2450)"
            stroke="var(--clr-primary,#7c5cfc)"
            stroke-width="1.5"
          />
          <rect
            x="160"
            y="45"
            width="110"
            height="50"
            rx="8"
            fill="var(--clr-bg-accent,#2a2450)"
            stroke="var(--clr-primary,#7c5cfc)"
            stroke-width="1.5"
          />
          <rect
            x="310"
            y="45"
            width="110"
            height="50"
            rx="8"
            fill="var(--clr-bg-accent,#2a2450)"
            stroke="var(--clr-primary,#7c5cfc)"
            stroke-width="1.5"
          />
          <rect
            x="460"
            y="45"
            width="110"
            height="50"
            rx="8"
            fill="var(--clr-bg-accent,#2a2450)"
            stroke="var(--clr-primary,#7c5cfc)"
            stroke-width="1.5"
          />
          <rect
            x="610"
            y="45"
            width="130"
            height="50"
            rx="8"
            fill="var(--clr-bg-accent,#2a2450)"
            stroke="var(--clr-primary,#7c5cfc)"
            stroke-width="1.5"
          />
          <!-- arrows -->
          <line
            x1="120"
            y1="70"
            x2="158"
            y2="70"
            stroke="var(--clr-primary,#7c5cfc)"
            stroke-width="1.6"
            marker-end="url(#arr)"
          />
          <line
            x1="270"
            y1="70"
            x2="308"
            y2="70"
            stroke="var(--clr-primary,#7c5cfc)"
            stroke-width="1.6"
            marker-end="url(#arr)"
          />
          <line
            x1="420"
            y1="70"
            x2="458"
            y2="70"
            stroke="var(--clr-primary,#7c5cfc)"
            stroke-width="1.6"
            marker-end="url(#arr)"
          />
          <line
            x1="570"
            y1="70"
            x2="608"
            y2="70"
            stroke="var(--clr-primary,#7c5cfc)"
            stroke-width="1.6"
            marker-end="url(#arr)"
          />
          <!-- labels -->
          <text x="65" y="66" text-anchor="middle" font-size="11" fill="var(--clr-text,#e8e6f0)">
            Shuffle deck
          </text>
          <text x="65" y="80" text-anchor="middle" font-size="11" fill="var(--clr-text,#e8e6f0)">
            &amp; draw hand
          </text>
          <text x="215" y="66" text-anchor="middle" font-size="11" fill="var(--clr-text,#e8e6f0)">
            Resolve
          </text>
          <text x="215" y="80" text-anchor="middle" font-size="11" fill="var(--clr-text,#e8e6f0)">
            mulligans
          </text>
          <text x="365" y="66" text-anchor="middle" font-size="11" fill="var(--clr-text,#e8e6f0)">
            Simulate
          </text>
          <text x="365" y="80" text-anchor="middle" font-size="11" fill="var(--clr-text,#e8e6f0)">
            N turns
          </text>
          <text x="515" y="66" text-anchor="middle" font-size="11" fill="var(--clr-text,#e8e6f0)">
            Record
          </text>
          <text x="515" y="80" text-anchor="middle" font-size="11" fill="var(--clr-text,#e8e6f0)">
            statistics
          </text>
          <text x="675" y="62" text-anchor="middle" font-size="11" fill="var(--clr-text,#e8e6f0)">
            Repeat √ó10 000
          </text>
          <text x="675" y="76" text-anchor="middle" font-size="11" fill="var(--clr-text,#e8e6f0)">
            ‚Üí average results
          </text>
          <!-- iteration arrow back -->
          <path
            d="M 675 95 Q 675 125 365 125 Q 55 125 65 95"
            fill="none"
            stroke="var(--clr-primary,#7c5cfc)"
            stroke-width="1.4"
            stroke-dasharray="5,3"
            marker-end="url(#arr)"
          />
          <text x="365" y="138" text-anchor="middle" font-size="10" fill="var(--clr-faint,#888)">
            next iteration
          </text>
        </svg>

        <p>
          Because every iteration starts with a freshly shuffled deck, the results are statistically
          independent. At 10,000 iterations the 95 % confidence interval on a probability is roughly
          <strong>¬±1 percentage point</strong> ‚Äî accurate enough to distinguish a 70 % mana-base
          from a 65 % one.
        </p>
      </div>

      <!-- ‚îÄ‚îÄ 2. Core Assumptions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div id="assumptions" class="tutorial-section">
        <h2>üìã Core Assumptions</h2>

        <h3>Deck composition</h3>
        <p>
          The simulator understands the following card roles. Cards are classified automatically
          when you parse a deck list ‚Äî each category can be toggled on or off in the UI before
          running the simulation:
        </p>
        <ul>
          <li>
            <strong>Lands</strong> ‚Äî the backbone of mana production. Includes basics, dual lands,
            fetch lands, shock lands, check lands, fast lands, slow lands, battle lands, MDFC lands,
            bounce lands, filter lands, Verge lands, Cabal Coffers-style scaling lands, and more.
          </li>
          <li>
            <strong>Mana artifacts</strong> ‚Äî Sol Ring, Signets, Talismans, Mox Opal, Mana Vault,
            etc. Each contributes mana every turn it is untapped on the battlefield.
          </li>
          <li>
            <strong>Mana creatures</strong> ‚Äî Llanowar Elves, Birds of Paradise, etc. They have
            summoning sickness the turn they enter and produce mana only from the following turn
            onwards.
          </li>
          <li>
            <strong>Exploration effects</strong> ‚Äî Exploration, Burgeoning, Oracle of Mul Daya, etc.
            These grant additional land drops per turn and are cast immediately before extra
            land-drop phases are resolved.
          </li>
          <li>
            <strong>Ramp spells</strong> ‚Äî Cultivate, Kodama's Reach, Farseek, Nature's Lore, etc.
            Cast greedily as soon as mana allows; they search the library for lands and put them
            onto the battlefield.
          </li>
          <li>
            <strong>Rituals</strong> ‚Äî Dark Ritual, Cabal Ritual, Seething Song, etc. These are
            one-shot burst mana sources counted separately in the <em>Burst</em> playability metric.
          </li>
          <li>
            <strong>Other spells</strong> ‚Äî everything not in the above categories. They do not
            generate mana but <em>do</em> consume mana, so their mana costs still influence the
            color-pip math.
          </li>
        </ul>

        <h3>Opening hand &amp; draw</h3>
        <p>
          Each iteration starts with a 7-card opening hand drawn from a freshly shuffled copy of the
          deck. <strong>Commander mode</strong> follows the rule of drawing a card on turn 1; in
          non-Commander mode the active player does not draw on their first turn.
        </p>
        <p>
          The simulator draws exactly one card per turn from the top of the library. Cards drawn by
          spells (e.g., Harmonize, Rhystic Study, extra-draw effects) are <em>not</em> simulated ‚Äî
          only the natural turn draw is modelled.
        </p>

        <h3>Land drops</h3>
        <p>
          The engine plays at most <strong>one land per turn</strong> by default. If an Exploration
          effect is on the battlefield (or enters this turn), additional land drops are granted up
          to that card's <code>landsPerTurn</code> value. The simulator always plays a land when one
          is available in hand, following the land-selection priority described in Section 4.
        </p>

        <div class="callout">
          <strong>Key assumption:</strong> The simulator plays lands and casts spells optimally but
          greedily ‚Äî it never deliberately holds a land for a future turn, and it casts every spell
          as soon as it can afford the mana cost. This models a "play as fast as possible" strategy
          and may overestimate consistency in lines that require deliberate sequencing decisions.
        </div>

        <h3>Mana sources and color pip matching</h3>
        <p>
          At the end of each simulated turn the engine tallies mana by walking every untapped
          permanent on the battlefield. Color pip matching uses a bipartite-coverage algorithm: it
          verifies that a card's specific color requirements (e.g., <code>{G}{G}</code>) can
          actually be satisfied by distinct untapped sources ‚Äî not just that the total mana is high
          enough.
        </p>

        <!-- Mana source type breakdown -->
        <svg
          viewBox="0 0 700 200"
          xmlns="http://www.w3.org/2000/svg"
          style="display: block; width: 100%; margin: 20px 0; font-family: sans-serif"
        >
          <!-- header -->
          <text
            x="350"
            y="24"
            text-anchor="middle"
            font-size="13"
            font-weight="bold"
            fill="var(--clr-primary,#7c5cfc)"
          >
            Mana Source Categories
          </text>
          <!-- col 1 -->
          <rect
            x="20"
            y="38"
            width="200"
            height="148"
            rx="6"
            fill="var(--clr-bg-accent,#1e1b30)"
            stroke="var(--clr-border,#3a355c)"
            stroke-width="1"
          />
          <text
            x="120"
            y="58"
            text-anchor="middle"
            font-size="11"
            font-weight="bold"
            fill="var(--clr-primary,#7c5cfc)"
          >
            Permanent Mana
          </text>
          <text x="35" y="78" font-size="10.5" fill="var(--clr-text,#ccc)">
            ‚Ä¢ Lands (tapped / untapped)
          </text>
          <text x="35" y="96" font-size="10.5" fill="var(--clr-text,#ccc)">
            ‚Ä¢ Mana artifacts (Sol Ring‚Ä¶)
          </text>
          <text x="35" y="114" font-size="10.5" fill="var(--clr-text,#ccc)">
            ‚Ä¢ Mana creatures (no sick)
          </text>
          <text x="35" y="132" font-size="10.5" fill="var(--clr-text,#ccc)">
            ‚Ä¢ Filter / Verge lands
          </text>
          <text x="35" y="150" font-size="10.5" fill="var(--clr-text,#ccc)">
            ‚Ä¢ Scaling lands (Coffers‚Ä¶)
          </text>
          <text x="35" y="168" font-size="10.5" fill="var(--clr-faint,#888)">
            Tracked every turn
          </text>
          <!-- col 2 -->
          <rect
            x="250"
            y="38"
            width="200"
            height="148"
            rx="6"
            fill="var(--clr-bg-accent,#1e1b30)"
            stroke="var(--clr-border,#3a355c)"
            stroke-width="1"
          />
          <text
            x="350"
            y="58"
            text-anchor="middle"
            font-size="11"
            font-weight="bold"
            fill="var(--clr-primary,#7c5cfc)"
          >
            Burst / One-Shot Mana
          </text>
          <text x="265" y="78" font-size="10.5" fill="var(--clr-text,#ccc)">
            ‚Ä¢ Rituals (Dark Ritual‚Ä¶)
          </text>
          <text x="265" y="96" font-size="10.5" fill="var(--clr-text,#ccc)">
            ‚Ä¢ Mox-style artifacts in hand
          </text>
          <text x="265" y="114" font-size="10.5" fill="var(--clr-text,#ccc)">
            ‚Ä¢ Tracked separately
          </text>
          <text x="265" y="168" font-size="10.5" fill="var(--clr-faint,#888)">
            Shown as "Burst" overlay
          </text>
          <!-- col 3 -->
          <rect
            x="480"
            y="38"
            width="200"
            height="148"
            rx="6"
            fill="var(--clr-bg-accent,#1e1b30)"
            stroke="var(--clr-border,#3a355c)"
            stroke-width="1"
          />
          <text
            x="580"
            y="58"
            text-anchor="middle"
            font-size="11"
            font-weight="bold"
            fill="var(--clr-primary,#7c5cfc)"
          >
            Life-Cost Mana
          </text>
          <text x="495" y="78" font-size="10.5" fill="var(--clr-text,#ccc)">
            ‚Ä¢ Shock lands (‚àí2 life, T1‚Äì6)
          </text>
          <text x="495" y="96" font-size="10.5" fill="var(--clr-text,#ccc)">
            ‚Ä¢ MDFC lands (‚àí3 life, T1‚Äì4)
          </text>
          <text x="495" y="114" font-size="10.5" fill="var(--clr-text,#ccc)">
            ‚Ä¢ Classic fetches (‚àí1 life)
          </text>
          <text x="495" y="132" font-size="10.5" fill="var(--clr-text,#ccc)">
            ‚Ä¢ Mana Vault upkeep
          </text>
          <text x="495" y="168" font-size="10.5" fill="var(--clr-faint,#888)">
            Tracked in Life Loss chart
          </text>
        </svg>

        <p>
          Shock lands and MDFC lands enter untapped only at a life cost, modelled as automatic
          payment in the early turns (turns 1‚Äì6 for shocks, 1‚Äì4 for MDFCs). From late-game turns
          onward they enter tapped for free, reflecting a real player's decision to stop paying life
          when tempo is less critical.
        </p>
      </div>

      <!-- ‚îÄ‚îÄ 3. Turn Anatomy ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div id="turn-anatomy" class="tutorial-section">
        <h2>üîÅ Turn Anatomy ‚Äî What Happens Each Simulated Turn</h2>

        <p>
          Every turn is resolved in seven sequential phases. Each phase runs to completion before
          the next begins.
        </p>

        <!-- Turn phases diagram -->
        <svg
          viewBox="0 0 720 290"
          xmlns="http://www.w3.org/2000/svg"
          style="display: block; width: 100%; margin: 20px 0; font-family: sans-serif"
        >
          <defs>
            <marker id="arr2" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
              <path d="M0,0 L0,6 L8,3 z" fill="var(--clr-border,#5a5580)" />
            </marker>
          </defs>
          <!-- Phase boxes ‚Äî two columns -->
          <!-- Left column: phases 1-4 -->
          <rect
            x="30"
            y="10"
            width="300"
            height="52"
            rx="7"
            fill="var(--clr-bg-accent,#1e1b30)"
            stroke="var(--clr-primary,#7c5cfc)"
            stroke-width="1.5"
          />
          <rect
            x="30"
            y="78"
            width="300"
            height="52"
            rx="7"
            fill="var(--clr-bg-accent,#1e1b30)"
            stroke="var(--clr-border,#44406a)"
            stroke-width="1.2"
          />
          <rect
            x="30"
            y="146"
            width="300"
            height="52"
            rx="7"
            fill="var(--clr-bg-accent,#1e1b30)"
            stroke="var(--clr-border,#44406a)"
            stroke-width="1.2"
          />
          <rect
            x="30"
            y="214"
            width="300"
            height="52"
            rx="7"
            fill="var(--clr-bg-accent,#1e1b30)"
            stroke="var(--clr-border,#44406a)"
            stroke-width="1.2"
          />
          <!-- Right column: phases 5-7 -->
          <rect
            x="388"
            y="10"
            width="300"
            height="52"
            rx="7"
            fill="var(--clr-bg-accent,#1e1b30)"
            stroke="var(--clr-border,#44406a)"
            stroke-width="1.2"
          />
          <rect
            x="388"
            y="78"
            width="300"
            height="52"
            rx="7"
            fill="var(--clr-bg-accent,#1e1b30)"
            stroke="var(--clr-border,#44406a)"
            stroke-width="1.2"
          />
          <rect
            x="388"
            y="146"
            width="300"
            height="52"
            rx="7"
            fill="var(--clr-bg-accent,#1e1b30)"
            stroke="var(--clr-border,#44406a)"
            stroke-width="1.2"
          />

          <!-- arrows left column -->
          <line
            x1="180"
            y1="62"
            x2="180"
            y2="76"
            stroke="var(--clr-border,#5a5580)"
            stroke-width="1.5"
            marker-end="url(#arr2)"
          />
          <line
            x1="180"
            y1="130"
            x2="180"
            y2="144"
            stroke="var(--clr-border,#5a5580)"
            stroke-width="1.5"
            marker-end="url(#arr2)"
          />
          <line
            x1="180"
            y1="198"
            x2="180"
            y2="212"
            stroke="var(--clr-border,#5a5580)"
            stroke-width="1.5"
            marker-end="url(#arr2)"
          />
          <!-- arrows right column -->
          <line
            x1="538"
            y1="62"
            x2="538"
            y2="76"
            stroke="var(--clr-border,#5a5580)"
            stroke-width="1.5"
            marker-end="url(#arr2)"
          />
          <line
            x1="538"
            y1="130"
            x2="538"
            y2="144"
            stroke="var(--clr-border,#5a5580)"
            stroke-width="1.5"
            marker-end="url(#arr2)"
          />
          <!-- bridge -->
          <path
            d="M 330 240 Q 360 240 360 36 Q 360 10 388 10"
            fill="none"
            stroke="var(--clr-primary,#7c5cfc)"
            stroke-width="1.5"
            stroke-dasharray="5,3"
            marker-end="url(#arr2)"
          />

          <!-- Phase labels -->
          <text x="45" y="30" font-size="11" font-weight="bold" fill="var(--clr-primary,#7c5cfc)">
            ‚ë† Untap / Upkeep / Draw
          </text>
          <text x="45" y="48" font-size="10.5" fill="var(--clr-text,#ccc)">
            All permanents untap. Mana Vault deals 1 damage if tapped.
          </text>
          <text x="45" y="98" font-size="11" font-weight="bold" fill="var(--clr-text,#e8e6f0)">
            ‚ë° First Land Drop
          </text>
          <text x="45" y="116" font-size="10.5" fill="var(--clr-text,#ccc)">
            Best land in hand is selected and played (see priority order).
          </text>
          <text x="45" y="166" font-size="11" font-weight="bold" fill="var(--clr-text,#e8e6f0)">
            ‚ë¢ Cast Exploration Effects
          </text>
          <text x="45" y="184" font-size="10.5" fill="var(--clr-text,#ccc)">
            Exploration-type permanents in hand are cast if affordable.
          </text>
          <text x="45" y="234" font-size="11" font-weight="bold" fill="var(--clr-text,#e8e6f0)">
            ‚ë£ Extra Land Drops
          </text>
          <text x="45" y="252" font-size="10.5" fill="var(--clr-text,#ccc)">
            Additional lands played up to the Exploration-granted limit.
          </text>

          <text x="403" y="30" font-size="11" font-weight="bold" fill="var(--clr-text,#e8e6f0)">
            ‚ë§ Activate Fetch Lands
          </text>
          <text x="403" y="48" font-size="10.5" fill="var(--clr-text,#ccc)">
            Fetches on battlefield crack for the best available target.
          </text>
          <text x="403" y="98" font-size="11" font-weight="bold" fill="var(--clr-text,#e8e6f0)">
            ‚ë• Cast Spells
          </text>
          <text x="403" y="116" font-size="10.5" fill="var(--clr-text,#ccc)">
            Ramp spells, artifacts, creatures cast greedily if affordable.
          </text>
          <text x="403" y="166" font-size="11" font-weight="bold" fill="var(--clr-text,#e8e6f0)">
            ‚ë¶ Record Statistics
          </text>
          <text x="403" y="184" font-size="10.5" fill="var(--clr-text,#ccc)">
            Land count, mana, color availability, key-card castability saved.
          </text>
        </svg>

        <h3>Land selection priority (Phase 2 &amp; 4)</h3>
        <p>
          When multiple lands are available in hand the engine applies the following tiebreaking
          priority to choose which one to play:
        </p>
        <ol>
          <li>
            <strong>Fetch land</strong> ‚Äî played first if enough untapped mana is already available
            to pay its activation cost.
          </li>
          <li>
            <strong>Untapped non-bounce land</strong> ‚Äî favoured over tapped sources to maximise
            mana available this turn.
          </li>
          <li>
            <strong>Bounce land</strong> (e.g., Azorius Chancery) ‚Äî played only when a non-bounce
            land can be returned to hand.
          </li>
          <li><strong>Any remaining land</strong> ‚Äî tapped lands, MDFCs, etc.</li>
        </ol>

        <h3>Fetch target selection (Phase 5)</h3>
        <p>
          When a fetch land activates it scores each eligible land in the library on several
          criteria and picks the highest-scoring one:
        </p>
        <ul>
          <li>
            +300 points for producing a color that key cards need but the battlefield currently
            cannot supply.
          </li>
          <li>+1000 points on turns 1‚Äì2 for any dual land (maximises early flexibility).</li>
          <li>+250 points per additional missing color pip covered.</li>
          <li>‚àí100 points for shock lands fetched after turn 6 (life conservation).</li>
        </ul>
      </div>

      <!-- ‚îÄ‚îÄ 4. Land Behaviour in Detail ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div id="land-behaviour" class="tutorial-section">
        <h2>üó∫ Land Behaviour in Detail</h2>

        <p>
          Lands are the most complex part of the simulation. Every land cycle has its own
          entering-the-battlefield (ETB) logic, mana-production rules, and sequencing interactions.
          This chapter walks through every major cycle and the key assumptions made when modelling
          each one. Hover over any land name in the parsed deck to see its Scryfall card image.
        </p>

        <!-- ‚îÄ‚îÄ Land Category Summary ‚îÄ‚îÄ -->
        <h3>Land categories at a glance</h3>

        <!-- SVG : three columns ‚Äî always untapped / conditional / always tapped -->
        <svg
          viewBox="0 0 740 380"
          xmlns="http://www.w3.org/2000/svg"
          style="display: block; width: 100%; margin: 16px 0; font-family: sans-serif"
        >
          <defs>
            <marker id="arrl" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
              <path d="M0,0 L0,6 L6,3 z" fill="var(--clr-border,#5a5580)" />
            </marker>
          </defs>
          <!-- ‚îÄ‚îÄ Column headers ‚îÄ‚îÄ -->
          <rect
            x="10"
            y="8"
            width="220"
            height="30"
            rx="6"
            fill="#1a3a2a"
            stroke="#4caf50"
            stroke-width="1.5"
          />
          <rect
            x="260"
            y="8"
            width="220"
            height="30"
            rx="6"
            fill="#2a2a1a"
            stroke="#ffcc44"
            stroke-width="1.5"
          />
          <rect
            x="510"
            y="8"
            width="220"
            height="30"
            rx="6"
            fill="#3a1a1a"
            stroke="#f44336"
            stroke-width="1.5"
          />
          <text
            x="120"
            y="29"
            text-anchor="middle"
            font-size="12"
            font-weight="bold"
            fill="#4caf50"
          >
            Always Untapped
          </text>
          <text
            x="370"
            y="29"
            text-anchor="middle"
            font-size="12"
            font-weight="bold"
            fill="#ffcc44"
          >
            Conditional
          </text>
          <text
            x="620"
            y="29"
            text-anchor="middle"
            font-size="12"
            font-weight="bold"
            fill="#f44336"
          >
            Always Tapped
          </text>
          <!-- ‚îÄ‚îÄ Column content ‚îÄ‚îÄ -->
          <!-- always untapped -->
          <text x="20" y="60" font-size="10.5" fill="var(--clr-text,#ccc)">
            Original Duals (ABUR)
          </text>
          <text x="20" y="78" font-size="10.5" fill="var(--clr-text,#ccc)">
            Shock Lands* (‚àí2 life, T1‚Äì6)
          </text>
          <text x="20" y="96" font-size="10.5" fill="var(--clr-text,#ccc)">
            Pain Lands (‚àí1 life/tap)
          </text>
          <text x="20" y="114" font-size="10.5" fill="var(--clr-text,#ccc)">
            5-Colour Pain (City of Brass‚Ä¶)
          </text>
          <text x="20" y="132" font-size="10.5" fill="var(--clr-text,#ccc)">Pathway Lands</text>
          <text x="20" y="150" font-size="10.5" fill="var(--clr-text,#ccc)">
            Horizon Lands (‚àí1 life/tap)
          </text>
          <text x="20" y="168" font-size="10.5" fill="var(--clr-text,#ccc)">
            MDFC Lands* (‚àí3 life, T1‚Äì4)
          </text>
          <text x="20" y="186" font-size="10.5" fill="var(--clr-text,#ccc)">
            Shadowmoor Filter Lands
          </text>
          <text x="20" y="204" font-size="10.5" fill="var(--clr-text,#ccc)">
            Odyssey / Fallout Filter
          </text>
          <text x="20" y="222" font-size="10.5" fill="var(--clr-text,#ccc)">
            Verge Lands (cond. 2nd colour)
          </text>
          <text x="20" y="240" font-size="10.5" fill="var(--clr-text,#ccc)">
            Lair Lands (3-colour bounce)
          </text>
          <text x="20" y="258" font-size="10.5" fill="var(--clr-text,#ccc)">
            Ancient Tomb (2√ó {C}, ‚àí2/upkeep)
          </text>
          <text x="20" y="276" font-size="10.5" fill="var(--clr-text,#ccc)">
            SNC Family (Hideaway-Fetch)
          </text>
          <text x="20" y="294" font-size="10.5" fill="var(--clr-text,#ccc)">Tron Lands ({C})</text>
          <!-- conditional -->
          <text x="270" y="60" font-size="10.5" fill="var(--clr-text,#ccc)">
            Fast Lands (‚â§2 lands in play)
          </text>
          <text x="270" y="78" font-size="10.5" fill="var(--clr-text,#ccc)">
            Slow Lands (‚â•2 lands in play)
          </text>
          <text x="270" y="96" font-size="10.5" fill="var(--clr-text,#ccc)">
            Battle Lands (‚â•2 basics in play)
          </text>
          <text x="270" y="114" font-size="10.5" fill="var(--clr-text,#ccc)">
            Check Lands (matching subtype)
          </text>
          <text x="270" y="132" font-size="10.5" fill="var(--clr-text,#ccc)">
            Crowd Lands (Commander mode)
          </text>
          <text x="270" y="150" font-size="10.5" fill="var(--clr-text,#ccc)">
            Bounce Lands (non-bounce to return)
          </text>
          <text x="270" y="168" font-size="10.5" fill="var(--clr-text,#ccc)">
            Classic Fetch Lands (‚àí1 life on crack)
          </text>
          <text x="270" y="186" font-size="10.5" fill="var(--clr-text,#ccc)">
            Mirage Fetch / Evolving Wilds
          </text>
          <text x="270" y="204" font-size="10.5" fill="var(--clr-text,#ccc)">
            Thriving Lands (2nd colour on ETB)
          </text>
          <text x="270" y="222" font-size="10.5" fill="var(--clr-text,#ccc)">
            Cabal Coffers (scales with Swamps)
          </text>
          <text x="270" y="240" font-size="10.5" fill="var(--clr-text,#ccc)">
            Temple of False God (‚â•5 lands)
          </text>
          <!-- always tapped -->
          <text x="520" y="60" font-size="10.5" fill="var(--clr-text,#ccc)">
            Triomes (3-colour + subtypes)
          </text>
          <text x="520" y="78" font-size="10.5" fill="var(--clr-text,#ccc)">
            Bounce Lands (Karoo cycle)
          </text>
          <text x="520" y="96" font-size="10.5" fill="var(--clr-text,#ccc)">
            Scry / Surveil / Bicycle Lands
          </text>
          <text x="520" y="114" font-size="10.5" fill="var(--clr-text,#ccc)">
            Gain / Refuge / Coastal Lands
          </text>
          <text x="520" y="132" font-size="10.5" fill="var(--clr-text,#ccc)">
            Snarl / Reveal Lands
          </text>
          <text x="520" y="150" font-size="10.5" fill="var(--clr-text,#ccc)">Vivid Lands</text>
          <text x="520" y="168" font-size="10.5" fill="var(--clr-text,#ccc)">Gate Lands</text>
          <text x="520" y="186" font-size="10.5" fill="var(--clr-text,#ccc)">
            Tri-Lands (Shards / Wedges)
          </text>
          <text x="520" y="204" font-size="10.5" fill="var(--clr-text,#ccc)">
            Man Lands (creature not modelled)
          </text>
          <text x="520" y="222" font-size="10.5" fill="var(--clr-text,#ccc)">
            Storage / Depletion Lands
          </text>
          <text x="520" y="240" font-size="10.5" fill="var(--clr-text,#ccc)">
            Hideaway Lands (Lorwyn)
          </text>
          <!-- borders around columns -->
          <rect
            x="10"
            y="45"
            width="220"
            height="262"
            rx="4"
            fill="none"
            stroke="#4caf50"
            stroke-width="0.75"
          />
          <rect
            x="260"
            y="45"
            width="220"
            height="210"
            rx="4"
            fill="none"
            stroke="#ffcc44"
            stroke-width="0.75"
          />
          <rect
            x="510"
            y="45"
            width="220"
            height="212"
            rx="4"
            fill="none"
            stroke="#f44336"
            stroke-width="0.75"
          />
          <!-- legend note -->
          <text x="10" y="316" font-size="10" fill="var(--clr-faint,#888)">
            * Enters tapped by default; life is paid to flip untapped in the early turns.
          </text>
          <text x="10" y="334" font-size="10" fill="var(--clr-faint,#888)">
            Conditional column: untapped only when the stated condition is met at the moment of
            play.
          </text>
          <text x="10" y="352" font-size="10" fill="var(--clr-faint,#888)">
            Tapped column: always enter tapped regardless of other conditions.
          </text>
        </svg>

        <!-- ‚îÄ‚îÄ ETB Logic block ‚îÄ‚îÄ -->
        <h3>ETB decision order</h3>
        <p>
          The engine evaluates each land in the following priority order to determine whether it
          enters the battlefield tapped or untapped. The first matching rule wins:
        </p>
        <ol>
          <li>
            <strong>Shock land</strong> ‚Üí always treated as entering tapped initially; the engine
            then pays 2 life and flips it untapped on turns 1‚Äì6. From turn 7 it stays tapped.
          </li>
          <li>
            <strong>MDFC land</strong> ‚Üí same pattern; pays 3 life and flips untapped on turns 1‚Äì4.
            Tapped with no cost from turn 5 onward.
          </li>
          <li>
            <strong>Fast land</strong> ‚Üí tapped when ‚â• 3 lands are already on the battlefield.
          </li>
          <li>
            <strong>Slow land</strong> ‚Üí tapped when &lt; 2 lands are already on the battlefield.
          </li>
          <li>
            <strong>Battle land</strong> ‚Üí tapped when &lt; 2 <em>basic</em> lands are already in
            play.
          </li>
          <li>
            <strong>Check land</strong> ‚Üí tapped unless a land with a matching basic subtype (e.g.
            Island or Swamp for Dragonskull Summit) is already in play.
          </li>
          <li><strong>Crowd land</strong> ‚Üí tapped when not in Commander mode.</li>
          <li>
            <strong>Always-tapped cycles</strong> (Triomes, Bounce Lands, Scry Lands, etc.) ‚Üí always
            tapped.
          </li>
          <li>
            <strong>Always-untapped cycles</strong> (Original Duals, Pain Lands, Pathways, etc.) ‚Üí
            always untapped.
          </li>
          <li>Default ‚Üí untapped.</li>
        </ol>

        <!-- ‚îÄ‚îÄ Filter Lands ‚îÄ‚îÄ -->
        <h3>Filter lands ‚Äî two-pass mana calculation</h3>
        <p>
          Filter lands don't add mana directly ‚Äî they <em>convert</em> one mana into two coloured
          mana. The engine handles them in a second pass after all other mana sources are tallied:
        </p>

        <!-- SVG: Shadowmoor vs Odyssey filter land logic -->
        <svg
          viewBox="0 0 700 180"
          xmlns="http://www.w3.org/2000/svg"
          style="display: block; width: 100%; margin: 16px 0; font-family: sans-serif"
        >
          <!-- ‚îÄ‚îÄ Shadowmoor ‚îÄ‚îÄ -->
          <rect
            x="10"
            y="10"
            width="330"
            height="160"
            rx="8"
            fill="var(--clr-bg-accent,#1e1b30)"
            stroke="var(--clr-primary,#7c5cfc)"
            stroke-width="1.4"
          />
          <text
            x="175"
            y="34"
            text-anchor="middle"
            font-size="11.5"
            font-weight="bold"
            fill="var(--clr-primary,#7c5cfc)"
          >
            Shadowmoor Filter Lands
          </text>
          <text x="175" y="52" text-anchor="middle" font-size="10" fill="var(--clr-faint,#888)">
            (Mystic Gate, Fetid Heath, etc.)
          </text>
          <text x="25" y="74" font-size="10.5" fill="var(--clr-text,#ccc)">
            Activation cost: tap a source producing
          </text>
          <text x="25" y="90" font-size="10.5" fill="var(--clr-text,#ccc)">
            colour A
            <tspan font-style="italic">or</tspan>
            colour B (the land's own colours)
          </text>
          <text x="25" y="110" font-size="10.5" fill="#4caf50">
            ‚úì consuming {W} or {U} ‚Üí produces {W}{W}, {U}{U} or {W}{U}
          </text>
          <text x="25" y="128" font-size="10.5" fill="#f44336">
            ‚úó pure {C} (Sol Ring alone) cannot activate it
          </text>
          <text x="25" y="148" font-size="10.5" fill="var(--clr-faint,#888)">
            Fallback: produces {C} if no coloured source available
          </text>
          <!-- ‚îÄ‚îÄ Odyssey ‚îÄ‚îÄ -->
          <rect
            x="360"
            y="10"
            width="330"
            height="160"
            rx="8"
            fill="var(--clr-bg-accent,#1e1b30)"
            stroke="var(--clr-border,#44406a)"
            stroke-width="1.4"
          />
          <text
            x="525"
            y="34"
            text-anchor="middle"
            font-size="11.5"
            font-weight="bold"
            fill="var(--clr-text,#e8e6f0)"
          >
            Odyssey / Fallout Filter Lands
          </text>
          <text x="525" y="52" text-anchor="middle" font-size="10" fill="var(--clr-faint,#888)">
            (Skycloud Expanse, Ferrous Lake, etc.)
          </text>
          <text x="375" y="74" font-size="10.5" fill="var(--clr-text,#ccc)">
            Activation cost: tap any 1 mana (generic {1})
          </text>
          <text x="375" y="90" font-size="10.5" fill="var(--clr-text,#ccc)">
            Any mana type qualifies, including {C}
          </text>
          <text x="375" y="110" font-size="10.5" fill="#4caf50">
            ‚úì consuming {C} from Sol Ring ‚Üí produces {U}{B}
          </text>
          <text x="375" y="128" font-size="10.5" fill="#4caf50">
            ‚úì consuming {W} from Plains ‚Üí produces {U}{B}
          </text>
          <text x="375" y="148" font-size="10.5" fill="var(--clr-faint,#888)">
            Fallback: produces {C} if total mana = 0
          </text>
        </svg>

        <!-- ‚îÄ‚îÄ Bounce Lands ‚îÄ‚îÄ -->
        <h3>Bounce lands</h3>
        <p>
          Two very different cycles share the <code>isBounce</code> flag and the same "return a land
          to hand" mechanic:
        </p>
        <ul>
          <li>
            <strong>Karoo cycle</strong> (Azorius Chancery, Dimir Aqueduct‚Ä¶) ‚Äî always enter tapped
            and produce 2 mana the following turn. They are a net-positive ramp tool that
            essentially trades one land drop now for two mana later.
          </li>
          <li>
            <strong>Lair lands</strong> (Crosis's Catacombs, Treva's Ruins‚Ä¶) ‚Äî enter
            <em>untapped</em> and produce three colours, but still require returning a non-bounce
            land.
          </li>
        </ul>
        <p>
          The engine only considers a bounce land playable if at least one non-bounce land is
          already on the battlefield to return. When bouncing, tapped lands are preferred over
          untapped ones to minimise tempo loss.
        </p>

        <!-- ‚îÄ‚îÄ Verge Lands ‚îÄ‚îÄ -->
        <h3>Verge lands ‚Äî conditional second colour</h3>

        <!-- SVG: Verge land secondary colour logic -->
        <svg
          viewBox="0 0 700 110"
          xmlns="http://www.w3.org/2000/svg"
          style="display: block; width: 100%; margin: 16px 0; font-family: sans-serif"
        >
          <defs>
            <marker id="arrv" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
              <path d="M0,0 L0,6 L6,3 z" fill="var(--clr-primary,#7c5cfc)" />
            </marker>
          </defs>
          <rect
            x="10"
            y="20"
            width="180"
            height="70"
            rx="6"
            fill="var(--clr-bg-accent,#1e1b30)"
            stroke="var(--clr-border,#44406a)"
            stroke-width="1.2"
          />
          <text
            x="100"
            y="42"
            text-anchor="middle"
            font-size="11"
            font-weight="bold"
            fill="var(--clr-text,#e0e0e0)"
          >
            Verge Land played
          </text>
          <text x="100" y="58" text-anchor="middle" font-size="10.5" fill="var(--clr-faint,#888)">
            (e.g. Sunbillow Verge)
          </text>
          <text x="100" y="76" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#ccc)">
            Primary colour: {W} always
          </text>
          <!-- arrow to check -->
          <line
            x1="190"
            y1="55"
            x2="258"
            y2="55"
            stroke="var(--clr-primary,#7c5cfc)"
            stroke-width="1.4"
            marker-end="url(#arrv)"
          />
          <!-- diamond check -->
          <polygon
            points="320,20 410,55 320,90 230,55"
            fill="var(--clr-bg-accent,#1e1b30)"
            stroke="var(--clr-primary,#7c5cfc)"
            stroke-width="1.4"
          />
          <text x="320" y="51" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#e8e6f0)">
            Mountain in play?
          </text>
          <text x="320" y="67" text-anchor="middle" font-size="10" fill="var(--clr-faint,#888)">
            (any with subtype)
          </text>
          <!-- Yes branch -->
          <line
            x1="410"
            y1="55"
            x2="500"
            y2="35"
            stroke="#4caf50"
            stroke-width="1.4"
            marker-end="url(#arrv)"
          />
          <text x="460" y="26" text-anchor="middle" font-size="10" fill="#4caf50">Yes</text>
          <rect
            x="500"
            y="10"
            width="185"
            height="36"
            rx="5"
            fill="#1a3a1a"
            stroke="#4caf50"
            stroke-width="1.2"
          />
          <text x="592" y="30" text-anchor="middle" font-size="10.5" fill="#4caf50">
            Produces {W} + {R}
          </text>
          <!-- No branch -->
          <line
            x1="410"
            y1="55"
            x2="500"
            y2="80"
            stroke="#f44336"
            stroke-width="1.4"
            marker-end="url(#arrv)"
          />
          <text x="460" y="96" text-anchor="middle" font-size="10" fill="#f44336">No</text>
          <rect
            x="500"
            y="60"
            width="185"
            height="36"
            rx="5"
            fill="#3a1a1a"
            stroke="#f44336"
            stroke-width="1.2"
          />
          <text x="592" y="80" text-anchor="middle" font-size="10.5" fill="#f44336">
            Produces {W} only
          </text>
          <text x="11" y="108" font-size="9.5" fill="var(--clr-faint,#888)">
            Check runs at mana-calculation time, not ETB ‚Äî a Mountain fetched earlier in the same
            turn grants secondary colour for spell-casting.
          </text>
        </svg>

        <!-- ‚îÄ‚îÄ Scaling Lands ‚îÄ‚îÄ -->
        <h3>Scaling &amp; context-dependent lands</h3>
        <p>
          Several lands produce a variable amount of mana depending on what else is on the
          battlefield. The engine handles each one specifically:
        </p>
        <ul>
          <li>
            <strong>Cabal Coffers</strong> ‚Äî net mana = max(0, Swamp count ‚àí 2). Produces nothing
            until 3 Swamps are in play.
          </li>
          <li>
            <strong>Cabal Stronghold</strong> ‚Äî same formula but counts only <em>basic</em> Swamps.
          </li>
          <li>
            <strong>Phyrexian Tower</strong> ‚Äî produces {B}{B} if a non-summoning-sick creature is
            on the battlefield (assuming you sacrifice it); otherwise produces {C}.
          </li>
          <li>
            <strong>Temple of the False God</strong> ‚Äî produces {C}{C} only when ‚â• 5 lands are
            already in play; produces nothing otherwise.
          </li>
          <li>
            <strong>Gaea's Cradle, Nykthos, etc.</strong> ‚Äî approximated as max(floor, turn ‚àí 1)
            mana, a rough proxy for their ramp power without counting actual creature or devotion
            counts.
          </li>
        </ul>

        <!-- ‚îÄ‚îÄ Life Loss ‚îÄ‚îÄ -->
        <h3>Life loss from lands ‚Äî complete table</h3>

        <!-- SVG table: life loss sources -->
        <svg
          viewBox="0 0 700 218"
          xmlns="http://www.w3.org/2000/svg"
          style="display: block; width: 100%; margin: 16px 0; font-family: sans-serif"
        >
          <!-- header row -->
          <rect
            x="10"
            y="8"
            width="310"
            height="26"
            rx="4"
            fill="var(--clr-primary,#7c5cfc)"
            opacity="0.3"
          />
          <rect
            x="325"
            y="8"
            width="105"
            height="26"
            rx="4"
            fill="var(--clr-primary,#7c5cfc)"
            opacity="0.3"
          />
          <rect
            x="435"
            y="8"
            width="255"
            height="26"
            rx="4"
            fill="var(--clr-primary,#7c5cfc)"
            opacity="0.3"
          />
          <text
            x="165"
            y="26"
            text-anchor="middle"
            font-size="11"
            font-weight="bold"
            fill="var(--clr-text,#e8e6f0)"
          >
            Source
          </text>
          <text
            x="377"
            y="26"
            text-anchor="middle"
            font-size="11"
            font-weight="bold"
            fill="var(--clr-text,#e8e6f0)"
          >
            Amount
          </text>
          <text
            x="562"
            y="26"
            text-anchor="middle"
            font-size="11"
            font-weight="bold"
            fill="var(--clr-text,#e8e6f0)"
          >
            When charged
          </text>
          <!-- data rows -->
          <text x="20" y="56" font-size="10.5" fill="var(--clr-text,#ccc)">Shock land</text>
          <text x="335" y="56" font-size="10.5" fill="var(--clr-text,#ccc)">2</text>
          <text x="445" y="56" font-size="10.5" fill="var(--clr-text,#ccc)">
            On ETB, turns 1‚Äì6 only
          </text>
          <text x="20" y="76" font-size="10.5" fill="var(--clr-text,#ccc)">MDFC land</text>
          <text x="335" y="76" font-size="10.5" fill="var(--clr-text,#ccc)">3</text>
          <text x="445" y="76" font-size="10.5" fill="var(--clr-text,#ccc)">
            On ETB, turns 1‚Äì4 only
          </text>
          <text x="20" y="96" font-size="10.5" fill="var(--clr-text,#ccc)">Classic fetch land</text>
          <text x="335" y="96" font-size="10.5" fill="var(--clr-text,#ccc)">1</text>
          <text x="445" y="96" font-size="10.5" fill="var(--clr-text,#ccc)">
            On activation (crack)
          </text>
          <text x="20" y="116" font-size="10.5" fill="var(--clr-text,#ccc)">
            Pain land / 5-colour pain
          </text>
          <text x="335" y="116" font-size="10.5" fill="var(--clr-text,#ccc)">1 / tap</text>
          <text x="445" y="116" font-size="10.5" fill="var(--clr-text,#ccc)">
            Turns 1‚Äì5 (assumed tapped for colour)
          </text>
          <text x="20" y="136" font-size="10.5" fill="var(--clr-text,#ccc)">Horizon land</text>
          <text x="335" y="136" font-size="10.5" fill="var(--clr-text,#ccc)">1 / tap</text>
          <text x="445" y="136" font-size="10.5" fill="var(--clr-text,#ccc)">
            Turns 1‚Äì5 (no colourless opt-out)
          </text>
          <text x="20" y="156" font-size="10.5" fill="var(--clr-text,#ccc)">Ancient Tomb</text>
          <text x="335" y="156" font-size="10.5" fill="var(--clr-text,#ccc)">2 / turn</text>
          <text x="445" y="156" font-size="10.5" fill="var(--clr-text,#ccc)">
            Every upkeep it is in play
          </text>
          <text x="20" y="176" font-size="10.5" fill="var(--clr-text,#ccc)">Mana Vault</text>
          <text x="335" y="176" font-size="10.5" fill="var(--clr-text,#ccc)">1 / turn</text>
          <text x="445" y="176" font-size="10.5" fill="var(--clr-text,#ccc)">
            Each upkeep while tapped
          </text>
          <text x="20" y="196" font-size="10.5" fill="var(--clr-text,#ccc)">Mana Crypt</text>
          <text x="335" y="196" font-size="10.5" fill="var(--clr-text,#ccc)">1.5 avg</text>
          <text x="445" y="196" font-size="10.5" fill="var(--clr-text,#ccc)">
            Per upkeep (50 % √ó 3 = 1.5 expected)
          </text>
          <text x="20" y="212" font-size="10.5" fill="var(--clr-text,#ccc)">
            Talisman (mana artifact)
          </text>
          <text x="335" y="212" font-size="10.5" fill="var(--clr-text,#ccc)">1 / tap</text>
          <text x="445" y="212" font-size="10.5" fill="var(--clr-text,#ccc)">
            Turns 1‚Äì5 (assumed tapped for colour)
          </text>
          <!-- grid lines -->
          <line
            x1="10"
            y1="34"
            x2="690"
            y2="34"
            stroke="var(--clr-border,#3a355c)"
            stroke-width="0.8"
          />
          <line
            x1="10"
            y1="62"
            x2="690"
            y2="62"
            stroke="var(--clr-border,#3a355c)"
            stroke-width="0.5"
          />
          <line
            x1="10"
            y1="82"
            x2="690"
            y2="82"
            stroke="var(--clr-border,#3a355c)"
            stroke-width="0.5"
          />
          <line
            x1="10"
            y1="102"
            x2="690"
            y2="102"
            stroke="var(--clr-border,#3a355c)"
            stroke-width="0.5"
          />
          <line
            x1="10"
            y1="122"
            x2="690"
            y2="122"
            stroke="var(--clr-border,#3a355c)"
            stroke-width="0.5"
          />
          <line
            x1="10"
            y1="142"
            x2="690"
            y2="142"
            stroke="var(--clr-border,#3a355c)"
            stroke-width="0.5"
          />
          <line
            x1="10"
            y1="162"
            x2="690"
            y2="162"
            stroke="var(--clr-border,#3a355c)"
            stroke-width="0.5"
          />
          <line
            x1="10"
            y1="182"
            x2="690"
            y2="182"
            stroke="var(--clr-border,#3a355c)"
            stroke-width="0.5"
          />
          <line
            x1="10"
            y1="202"
            x2="690"
            y2="202"
            stroke="var(--clr-border,#3a355c)"
            stroke-width="0.5"
          />
          <line
            x1="323"
            y1="8"
            x2="323"
            y2="218"
            stroke="var(--clr-border,#3a355c)"
            stroke-width="0.8"
          />
          <line
            x1="433"
            y1="8"
            x2="433"
            y2="218"
            stroke="var(--clr-border,#3a355c)"
            stroke-width="0.8"
          />
          <rect
            x="10"
            y="8"
            width="680"
            height="210"
            rx="4"
            fill="none"
            stroke="var(--clr-border,#44406a)"
            stroke-width="1"
          />
        </svg>

        <!-- ‚îÄ‚îÄ Notable simplifications ‚îÄ‚îÄ -->
        <h3>Notable land-related simplifications</h3>

        <div class="callout" style="margin-bottom: 10px">
          <strong>Reveal lands always enter tapped.</strong> Cards like Port Town enter untapped if
          you reveal a Plains or Island from your hand. Because the hand is known to the simulation,
          this condition <em>could</em> be checked ‚Äî but it currently is not. This means the sim
          slightly underestimates the turn-1/2 speed of reveal-heavy mana bases.
        </div>
        <div class="callout" style="margin-bottom: 10px">
          <strong>Shock / MDFC life payments are unconditional in the early turns.</strong> The
          simulator always pays 2 life (shock) or 3 life (MDFC) in the early-turn window ‚Äî it never
          takes the tapped option to conserve life. Real players may stop paying below a life-total
          threshold, so the life-loss chart represents a worst-case aggressive sequencing.
        </div>
        <div class="callout" style="margin-bottom: 10px">
          <strong>Pain / Horizon land damage is charged every turn 1‚Äì5.</strong> In practice a
          player might tap a pain land for colourless or not tap it at all. The simulation
          simplifies this by charging the life cost every turn these lands are on the battlefield,
          overestimating life loss slightly in slower games.
        </div>
        <div class="callout">
          <strong>Scaling lands (Gaea's Cradle, Nykthos‚Ä¶) use a turn-count proxy.</strong>
          Rather than counting actual creatures or devotion pips, these lands produce max(floor,
          turn ‚àí 1) mana. This gives a reasonable ramp curve but will be inaccurate for decks that
          assemble many creatures very early or very late.
        </div>
      </div>

      <!-- ‚îÄ‚îÄ 5. What Is and Isn't Modelled ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div id="modelled" class="tutorial-section">
        <h2>‚úÖ What the Simulator Models</h2>
        <ul>
          <li>
            Drawing one card per turn (Commander mode draws on turn 1; non-Commander does not).
          </li>
          <li>
            Playing one land per turn, plus extra drops from Exploration effects on the battlefield.
          </li>
          <li>
            All common land types: basics, fetches (Onslaught/Zendikar classics, Mirage fetches,
            Evolving Wilds, MH3 Landscapes, Panoramas, Prismatic Vista, and more), shock lands,
            check lands, fast lands, slow lands, battle lands, bounce lands (Karoo cycle and Lair
            lands), MDFC lands, filter lands (Shadowmoor and Odyssey/Fallout variants), Verge lands,
            Horizon lands, Crowd lands, Thriving lands, and scaling lands (Cabal Coffers, Nykthos,
            etc.).
          </li>
          <li>
            Shock lands paying 2 life to enter untapped on turns 1‚Äì6; MDFC lands paying 3 life to
            enter untapped on turns 1‚Äì4.
          </li>
          <li>Classic fetch lands paying 1 life when they activate.</li>
          <li>Mana Vault dealing 1 damage per upkeep if it remains tapped.</li>
          <li>
            Summoning sickness ‚Äî mana creatures produce mana only from the turn after they enter.
          </li>
          <li>Exploration-type effects granting additional land drops each turn.</li>
          <li>
            Ramp spells searching the library for lands (with correct filter restrictions ‚Äî basic
            only, forest, etc.).
          </li>
          <li>Rituals and hand-zero Mox artifacts as a separate <em>burst mana</em> pool.</li>
          <li>City of Traitors being sacrificed when another land is played.</li>
          <li>Bounce lands returning the cheapest legal target to hand.</li>
          <li>London and Vancouver mulligan rules with four configurable strategies.</li>
          <li>
            Per-turn statistics: average lands, untapped lands, total mana, per-color mana, life
            loss.
          </li>
          <li>
            Key-card castability per turn (with and without burst mana), on-curve castability.
          </li>
          <li>
            Mana flood rate (‚â• N lands on battlefield by turn T) and mana screw rate (‚â§ N lands by
            turn T).
          </li>
          <li>Standard deviation on all numeric outputs for statistical confidence.</li>
          <li>
            Shareable URLs ‚Äî the complete app state is compressed and encoded in the URL hash so you
            can share an exact configuration with a link.
          </li>
          <li>
            Hover tooltips ‚Äî hovering any card name shows a live Scryfall card image; Scryfall API
            calls are rate-limited (soft warning at 60 calls, hard block at 150 per session).
          </li>
        </ul>

        <h2 style="margin-top: 28px">‚ùå What It Does Not Model</h2>
        <ul>
          <li>
            <strong>Opponent actions</strong> ‚Äî counterspells, hand disruption, land destruction,
            and any interaction are completely absent.
          </li>
          <li>
            <strong>Card-draw spells</strong> ‚Äî Brainstorm, Rhystic Study, Harmonize, or any
            non-land card that draws additional cards. Only the one natural draw per turn is
            simulated.
          </li>
          <li><strong>Combat &amp; damage</strong> ‚Äî no attacking, blocking, or combat damage.</li>
          <li>
            <strong>Multi-spell sequencing within a turn</strong> ‚Äî spells are cast in a fixed order
            (exploration effects ‚Üí ramp ‚Üí other spells). Optimal sequencing within a turn that
            requires playing a ramp spell <em>before</em> a land drop is not attempted.
          </li>
          <li>
            <strong>Activated abilities beyond mana</strong> ‚Äî the engine only models tap-for-mana
            (and fetch-land activation). Planeswalker abilities, equipment, etc. are ignored.
          </li>
          <li>
            <strong>Triggered abilities</strong> ‚Äî landfall triggers, death triggers, "when you
            cast" effects, etc. are not tracked.
          </li>
          <li>
            <strong>Commander itself</strong> ‚Äî Commander mode only enables the turn-1 draw; the
            Commander card is not placed in the command zone, no commander tax is modelled, and
            command damage is not tracked.
          </li>
          <li><strong>Sideboard</strong> ‚Äî only the main deck is used.</li>
        </ul>
      </div>

      <!-- ‚îÄ‚îÄ 5. Mulligan Logic ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div id="mulligans" class="tutorial-section">
        <h2>üîÑ Mulligan Logic</h2>

        <p>
          When mulligans are enabled the engine applies up to <strong>6 mulligan attempts</strong>
          per iteration. Two rules are supported, selectable in the Simulation Settings panel:
        </p>
        <ul>
          <li>
            <strong>London Mulligan</strong> (default) ‚Äî draw a fresh 7-card hand, then put
            <em>N</em> cards back (where N = number of mulligans taken so far), choosing the ones
            that are least needed based on whether the hand is land-heavy or land-light.
            <br /><strong>Commander mode:</strong> the first mulligan is free ‚Äî you draw 7 fresh
            cards and bottom <em>zero</em> (official Commander rule). Subsequent mulligans reduce
            the hand by one card as normal.
          </li>
          <li>
            <strong>Vancouver Mulligan</strong> ‚Äî draw a hand of <em>7 ‚àí N</em> cards and keep it
            as-is; no bottom decisions are modelled. <br /><strong>Commander mode:</strong> first
            redraw is still a full 7 cards.
          </li>
        </ul>

        <h3>Mulligan strategies</h3>

        <!-- Mulligan decision tree -->
        <svg
          viewBox="0 0 700 310"
          xmlns="http://www.w3.org/2000/svg"
          style="display: block; width: 100%; margin: 20px 0; font-family: sans-serif"
        >
          <defs>
            <marker id="arr3" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
              <path d="M0,0 L0,6 L8,3 z" fill="var(--clr-primary,#7c5cfc)" />
            </marker>
          </defs>
          <!-- Start -->
          <rect x="270" y="10" width="160" height="40" rx="20" fill="var(--clr-primary,#7c5cfc)" />
          <text x="350" y="35" text-anchor="middle" font-size="12" font-weight="bold" fill="#fff">
            Opening 7-card hand
          </text>
          <!-- Arrow to decision -->
          <line
            x1="350"
            y1="50"
            x2="350"
            y2="72"
            stroke="var(--clr-primary,#7c5cfc)"
            stroke-width="1.5"
            marker-end="url(#arr3)"
          />
          <!-- Decision diamond -->
          <polygon
            points="350,74 460,110 350,146 240,110"
            fill="var(--clr-bg-accent,#1e1b30)"
            stroke="var(--clr-primary,#7c5cfc)"
            stroke-width="1.5"
          />
          <text
            x="350"
            y="106"
            text-anchor="middle"
            font-size="10.5"
            fill="var(--clr-text,#e8e6f0)"
          >
            Count lands in hand
          </text>
          <text
            x="350"
            y="122"
            text-anchor="middle"
            font-size="10.5"
            fill="var(--clr-text,#e8e6f0)"
          >
            (L = land count)
          </text>
          <!-- Keep branch -->
          <line
            x1="460"
            y1="110"
            x2="580"
            y2="110"
            stroke="#4caf50"
            stroke-width="1.5"
            marker-end="url(#arr3)"
          />
          <text x="520" y="104" text-anchor="middle" font-size="10" fill="#4caf50">Keep</text>
          <rect
            x="580"
            y="90"
            width="105"
            height="40"
            rx="6"
            fill="#1a3a1a"
            stroke="#4caf50"
            stroke-width="1.2"
          />
          <text x="632" y="108" text-anchor="middle" font-size="10.5" fill="#4caf50">
            Hand kept ‚úì
          </text>
          <text x="632" y="122" text-anchor="middle" font-size="10" fill="#4caf50">
            Start simulation
          </text>
          <!-- Mulligan branch -->
          <line
            x1="240"
            y1="110"
            x2="120"
            y2="110"
            stroke="#f44336"
            stroke-width="1.5"
            marker-end="url(#arr3)"
          />
          <text x="180" y="104" text-anchor="middle" font-size="10" fill="#f44336">Mulligan</text>
          <rect
            x="14"
            y="90"
            width="106"
            height="40"
            rx="6"
            fill="#3a1a1a"
            stroke="#f44336"
            stroke-width="1.2"
          />
          <text x="67" y="108" text-anchor="middle" font-size="10.5" fill="#f44336">
            New hand drawn
          </text>
          <text x="67" y="122" text-anchor="middle" font-size="10" fill="#f44336">
            (repeat, max 6√ó)
          </text>
          <!-- Strategy table -->
          <text
            x="350"
            y="180"
            text-anchor="middle"
            font-size="12"
            font-weight="bold"
            fill="var(--clr-primary,#7c5cfc)"
          >
            Keep / Mulligan Conditions by Strategy
          </text>
          <!-- Table header -->
          <rect
            x="20"
            y="192"
            width="150"
            height="24"
            rx="4"
            fill="var(--clr-primary,#7c5cfc)"
            opacity="0.25"
          />
          <rect
            x="175"
            y="192"
            width="160"
            height="24"
            rx="4"
            fill="var(--clr-primary,#7c5cfc)"
            opacity="0.25"
          />
          <rect
            x="340"
            y="192"
            width="160"
            height="24"
            rx="4"
            fill="var(--clr-primary,#7c5cfc)"
            opacity="0.25"
          />
          <rect
            x="505"
            y="192"
            width="185"
            height="24"
            rx="4"
            fill="var(--clr-primary,#7c5cfc)"
            opacity="0.25"
          />
          <text
            x="95"
            y="209"
            text-anchor="middle"
            font-size="11"
            font-weight="bold"
            fill="var(--clr-text,#e8e6f0)"
          >
            Strategy
          </text>
          <text
            x="255"
            y="209"
            text-anchor="middle"
            font-size="11"
            font-weight="bold"
            fill="var(--clr-text,#e8e6f0)"
          >
            Mull if L &lt; ‚Ä¶
          </text>
          <text
            x="420"
            y="209"
            text-anchor="middle"
            font-size="11"
            font-weight="bold"
            fill="var(--clr-text,#e8e6f0)"
          >
            Mull if L &gt; ‚Ä¶
          </text>
          <text
            x="597"
            y="209"
            text-anchor="middle"
            font-size="11"
            font-weight="bold"
            fill="var(--clr-text,#e8e6f0)"
          >
            Extra condition
          </text>
          <!-- rows -->
          <text x="95" y="232" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#ccc)">
            Conservative
          </text>
          <text x="255" y="232" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#ccc)">
            0 lands
          </text>
          <text x="420" y="232" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#ccc)">
            7 lands
          </text>
          <text x="597" y="232" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#ccc)">
            ‚Äî
          </text>

          <text x="95" y="252" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#ccc)">
            Balanced
          </text>
          <text x="255" y="252" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#ccc)">
            2 lands
          </text>
          <text x="420" y="252" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#ccc)">
            5 lands
          </text>
          <text x="597" y="252" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#ccc)">
            Must have ‚â•1 spell ‚â§2 CMC
          </text>

          <text x="95" y="272" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#ccc)">
            Aggressive
          </text>
          <text x="255" y="272" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#ccc)">
            2 lands
          </text>
          <text x="420" y="272" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#ccc)">
            4 lands
          </text>
          <text x="597" y="272" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#ccc)">
            Prioritises action hands
          </text>

          <text x="95" y="292" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#ccc)">
            Custom
          </text>
          <text x="255" y="292" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#ccc)">
            Configurable
          </text>
          <text x="420" y="292" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#ccc)">
            Configurable
          </text>
          <text x="597" y="292" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#ccc)">
            Set thresholds manually
          </text>
        </svg>

        <div class="callout">
          <strong>Tip:</strong> Enabling mulligans and using the <em>Balanced</em> strategy is the
          closest approximation of how an experienced Commander player actually mulligans. Use
          <em>Conservative</em> if you want to study your raw opening-hand distribution, or
          <em>Aggressive</em> to model streamlined combo/aggro strategies.
        </div>
      </div>

      <!-- ‚îÄ‚îÄ 6. Key-Card Playability ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div id="keycards" class="tutorial-section">
        <h2>üéØ Key-Card Playability</h2>

        <p>
          Mark any spell in your deck as a <strong>Key Card</strong> and the simulator tracks in how
          many iterations you had enough mana of the right colors to cast it, turn by turn. The
          result is displayed as a percentage:
          <em>"I can cast this card by turn N in X % of games."</em>
        </p>

        <h3>Regular vs. Burst playability</h3>
        <p>The engine computes two separate numbers each turn:</p>
        <ul>
          <li>
            <strong>Regular</strong> ‚Äî mana from permanents on the battlefield only (lands,
            artifacts, non-sick creatures). This represents casting the card at sorcery speed with
            no one-shot acceleration.
          </li>
          <li>
            <strong>Burst</strong> ‚Äî regular mana plus any unplayed ritual or Mox-style artifact
            still in hand. This represents the highest possible mana output for that turn if you are
            willing to spend the burst pieces.
          </li>
        </ul>

        <h3>On-curve playability</h3>
        <p>
          A card is considered <em>on curve</em> when you can cast it on the turn equal to its
          converted mana cost ‚Äî a CMC-3 card on turn 3, a CMC-6 card on turn 6. The on-curve
          percentage is a single headline number (not a per-turn graph) that answers:
          <em>"Do I reliably hit this card on its natural turn?"</em>
        </p>

        <h3>Play sequences</h3>
        <p>
          For each key card the simulator saves one example play sequence (the exact turn-by-turn
          action log) for every turn on which the card first became castable. Click any turn bar in
          the results chart to inspect a real simulated game that achieved playability on that turn.
          This is invaluable for sanity-checking why a card appears castable earlier or later than
          expected.
        </p>

        <div class="callout">
          <strong>Color pip accuracy:</strong> The castability check is not just about total mana.
          The engine verifies that specific color requirements can be fulfilled by distinct,
          untapped mana sources. A hand with four Swamps and no other sources <em>cannot</em> cast
          <code>{2}{W}{W}</code> ‚Äî even though total mana ‚â• 4 ‚Äî because the two {W} pips have no
          valid source.
        </div>
      </div>

      <!-- ‚îÄ‚îÄ 7. Flood &amp; Screw Tracking ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div id="flood-screw" class="tutorial-section">
        <h2>üåä Flood &amp; Screw Tracking</h2>

        <p>Two headline risk metrics are computed once all iterations are complete:</p>

        <!-- Flood / Screw diagram -->
        <svg
          viewBox="0 0 680 130"
          xmlns="http://www.w3.org/2000/svg"
          style="display: block; width: 100%; margin: 20px 0; font-family: sans-serif"
        >
          <!-- flood box -->
          <rect
            x="20"
            y="20"
            width="300"
            height="90"
            rx="8"
            fill="var(--clr-bg-accent,#1e1b30)"
            stroke="#3fa7ff"
            stroke-width="1.5"
          />
          <text
            x="170"
            y="45"
            text-anchor="middle"
            font-size="12"
            font-weight="bold"
            fill="#3fa7ff"
          >
            üåä Mana Flood Rate
          </text>
          <text x="170" y="67" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#ccc)">
            % of games with ‚â• N lands on battlefield
          </text>
          <text x="170" y="83" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#ccc)">
            by turn T. Default: ‚â• 5 lands by turn 5.
          </text>
          <text x="170" y="101" text-anchor="middle" font-size="10" fill="var(--clr-faint,#888)">
            High flood rate ‚Üí consider cutting a land.
          </text>
          <!-- screw box -->
          <rect
            x="360"
            y="20"
            width="300"
            height="90"
            rx="8"
            fill="var(--clr-bg-accent,#1e1b30)"
            stroke="#ff9b3f"
            stroke-width="1.5"
          />
          <text
            x="510"
            y="45"
            text-anchor="middle"
            font-size="12"
            font-weight="bold"
            fill="#ff9b3f"
          >
            üèú Mana Screw Rate
          </text>
          <text x="510" y="67" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#ccc)">
            % of games with ‚â§ N lands on battlefield
          </text>
          <text x="510" y="83" text-anchor="middle" font-size="10.5" fill="var(--clr-text,#ccc)">
            by turn T. Default: ‚â§ 2 lands by turn 3.
          </text>
          <text x="510" y="101" text-anchor="middle" font-size="10" fill="var(--clr-faint,#888)">
            High screw rate ‚Üí add lands or ramp.
          </text>
        </svg>

        <p>
          Both thresholds are configurable in the Simulation Settings panel. Adjust them to match
          the specific consistency bar your deck requires ‚Äî a fast combo deck tolerates almost no
          screw, while a slow control deck can absorb occasional flood.
        </p>
        <p>
          Flood and screw rates capture a single snapshot (one turn, one land-count threshold) and
          should be read alongside the full <em>Average Lands per Turn</em> chart, which shows the
          distribution across all turns and thus gives a richer picture of ramp trajectory and
          late-game land count.
        </p>
      </div>

      <!-- ‚îÄ‚îÄ 8. Tips & Tricks ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div id="tips" class="tutorial-section">
        <h2>üí° Tips &amp; Tricks</h2>

        <ol>
          <li>
            <strong>Start with a target turn.</strong> Decide what you need to be doing by when
            (e.g., "cast my commander on turn 4, cast the win condition on turn 7") and add those
            cards as Key Cards. The simulation tells you whether your land base supports those
            ambitions.
          </li>
          <li>
            <strong>Use the Comparison tool.</strong> Paste two versions of a deck and run both
            simultaneously. The side-by-side panel highlights which mana base produces more total
            mana and which hits key cards more reliably.
          </li>
          <li>
            <strong>Toggle ramp spells on and off.</strong> Disabling all ramp spells and running
            the simulation shows you your raw land-only baseline. Re-enabling them reveals the exact
            ramp contribution turn by turn.
          </li>
          <li>
            <strong>Check life loss.</strong> Heavy shock-land and fetch-land suites can lose
            significant life by turn 5. The Life Loss chart quantifies this ‚Äî useful for estimating
            how much pressure you are putting on your own life total.
          </li>
          <li>
            <strong>Increase iterations for high-precision results.</strong> The default 10,000
            gives ‚âà ¬±1 % confidence. For fine distinctions (e.g., 67 % vs. 69 %) run 50,000+
            iterations. The slider in Simulation Settings controls this.
          </li>
          <li>
            <strong>Interpret Flood / Screw thresholds in context.</strong> A 20 % flood rate is not
            inherently bad if your deck wants lots of lands (e.g., Lord Windgrace). Set the
            threshold to the actual point where extra lands become dead draws in your specific deck.
          </li>
          <li>
            <strong>Use Burst playability for storm or reanimator lines.</strong> If a single ritual
            or Mox brings a key card online a full turn earlier, the Burst chart will show a
            noticeably higher bar on that turn ‚Äî confirmation that the burst pieces are pulling
            their weight.
          </li>
          <li>
            <strong>Click play sequences.</strong> In the Key-Card results panel, each turn bar is
            clickable and shows an example hand + full turn log. Use this to spot unrealistic
            sequencing assumptions and to find the actual cards that are enabling early casts.
          </li>
          <li>
            <strong>Share your configuration.</strong> After running a simulation, copy the URL ‚Äî
            the entire deck list, settings, and key cards are encoded in the URL hash. Paste it
            anywhere to let someone else reproduce your exact run instantly, no login required.
          </li>
        </ol>
      </div>

      <div class="app-footer">
        <p>Commandertables ‚Äî Monte Carlo Deck Analyzer</p>
      </div>
    </div>
    <!-- /.tutorial-root -->

    <script>
      // Mirror the theme toggle from the main app
      const btn = document.getElementById('theme-toggle');
      const updateBtn = () => {
        const dark = document.documentElement.getAttribute('data-theme') === 'dark';
        btn.textContent = dark ? '‚òÄÔ∏è Light' : 'üåô Dark';
      };
      updateBtn();
      btn.addEventListener('click', () => {
        const next =
          document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', next);
        localStorage.setItem('mtg_mca_theme', next);
        updateBtn();
      });
    </script>
  </body>
</html>
